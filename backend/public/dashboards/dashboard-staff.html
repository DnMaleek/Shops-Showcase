<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Staff Dashboard</title>

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="manifest" href="/images/site.webmanifest">

  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-50">

<script>
// Auth check
if(!localStorage.getItem("staffToken")) {
  window.location.href = "/login/login-staff.html";
}
</script>

<div class="flex min-h-screen">

  <!-- Mobile Header with Hamburger -->
  <div class="lg:hidden fixed top-0 left-0 right-0 bg-gradient-to-r from-green-700 to-green-600 text-white p-4 z-40 flex items-center justify-between shadow-lg">
    <div class="flex items-center gap-3">
      <div class="w-8 h-8 bg-white/20 rounded-lg flex items-center justify-center">
        <i class="fas fa-store text-sm"></i>
      </div>
      <h2 class="text-lg font-bold">Staff Panel</h2>
    </div>
    <button onclick="toggleSidebar()" class="text-white focus:outline-none hover:bg-white/10 p-2 rounded-lg transition">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path id="hamburgerIcon" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        <path id="closeIcon" class="hidden" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
      </svg>
    </button>
  </div>

  <!-- Overlay for mobile -->
  <div id="sidebarOverlay" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-30 hidden lg:hidden" onclick="toggleSidebar()"></div>

  <!-- Sidebar -->
  <aside id="sidebar" class="fixed w-72 bg-gradient-to-b from-green-700 to-green-800 text-white h-screen z-40 transform -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out shadow-2xl overflow-y-auto">
    <div class="p-6">
      <!-- Logo Section -->
      <div class="hidden lg:flex items-center gap-3 mb-8 pb-6 border-b border-white/10">
        <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center backdrop-blur-sm">
          <i class="fas fa-store text-xl"></i>
        </div>
        <div>
          <h2 class="text-xl font-bold">Staff Panel</h2>
          <p class="text-xs text-green-200">Manage Your Store</p>
        </div>
      </div>

      <!-- Navigation -->
      <nav class="mt-16 lg:mt-0">
        <p class="text-xs font-semibold text-green-300 mb-3 px-2 uppercase tracking-wider">Main Menu</p>
        <ul class="space-y-2">
          <li>
            <button onclick="showSection('products'); closeSidebarMobile();" class="w-full flex items-center gap-3 hover:bg-white/10 p-3 rounded-lg cursor-pointer transition group">
              <div class="w-8 h-8 bg-white/10 rounded-lg flex items-center justify-center group-hover:bg-white/20 transition">
                <i class="fas fa-box text-sm"></i>
              </div>
              <span class="font-medium">Products</span>
            </button>
          </li>
          <li>
            <button onclick="showSection('products'); closeSidebarMobile();" class="w-full flex items-center gap-3 hover:bg-white/10 p-3 rounded-lg cursor-pointer transition group">
              <div class="w-8 h-8 bg-white/10 rounded-lg flex items-center justify-center group-hover:bg-white/20 transition">
                <i class="fas fa-chart-line text-sm"></i>
              </div>
              <span class="font-medium">Analytics</span>
            </button>
          </li>
          <li>
            <button onclick="showSection('products'); closeSidebarMobile();" class="w-full flex items-center gap-3 hover:bg-white/10 p-3 rounded-lg cursor-pointer transition group">
              <div class="w-8 h-8 bg-white/10 rounded-lg flex items-center justify-center group-hover:bg-white/20 transition">
                <i class="fas fa-shopping-cart text-sm"></i>
              </div>
              <span class="font-medium">Orders</span>
            </button>
          </li>
        </ul>

        <p class="text-xs font-semibold text-green-300 mb-3 px-2 uppercase tracking-wider mt-8">Account</p>
        <ul class="space-y-2">
          <li>
            <button onclick="logout()" class="w-full flex items-center gap-3 hover:bg-red-500/80 p-3 rounded-lg cursor-pointer transition group">
              <div class="w-8 h-8 bg-white/10 rounded-lg flex items-center justify-center group-hover:bg-white/20 transition">
                <i class="fas fa-sign-out-alt text-sm"></i>
              </div>
              <span class="font-medium">Logout</span>
            </button>
          </li>
        </ul>
      </nav>
    </div>

    <!-- User Info at Bottom -->
    <div class="absolute bottom-0 left-0 right-0 p-6 bg-green-900/50 border-t border-white/10">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center">
          <i class="fas fa-user text-sm"></i>
        </div>
        <div class="flex-1">
          <p class="text-sm font-semibold">Staff Member</p>
          <p class="text-xs text-green-200">Online</p>
        </div>
      </div>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="flex-1 min-h-screen lg:ml-72 bg-gray-50 overflow-y-auto">
    <div class="p-4 lg:p-8 max-w-7xl mx-auto mt-16 lg:mt-0">
      <div id="products">
        <!-- Header Section -->
        <div class="mb-6 lg:mb-8">
          <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
            <div>
              <h1 class="text-2xl lg:text-3xl font-bold text-gray-900">Product Management</h1>
              <p class="text-sm lg:text-base text-gray-600 mt-1">Manage your inventory and product listings</p>
            </div>
            <button onclick="openAddProductModal()" class="w-full lg:w-auto bg-gradient-to-r from-green-600 to-green-700 text-white px-6 py-3 rounded-xl font-semibold hover:from-green-700 hover:to-green-800 transition shadow-lg hover:shadow-xl flex items-center justify-center gap-2">
              <i class="fas fa-plus"></i>
              <span>Add New Product</span>
            </button>
          </div>
        </div>

        <!-- Stats Cards -->
        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6 lg:mb-8">
          <div class="bg-white rounded-xl shadow-sm p-4 lg:p-6 border border-gray-100 hover:shadow-md transition">
            <div class="flex items-center justify-between mb-2">
              <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                <i class="fas fa-box text-blue-600"></i>
              </div>
            </div>
            <p class="text-xs lg:text-sm text-gray-600">Total Products</p>
            <p id="totalProducts" class="text-xl lg:text-2xl font-bold text-gray-900 mt-1">0</p>
          </div>

          <div class="bg-white rounded-xl shadow-sm p-4 lg:p-6 border border-gray-100 hover:shadow-md transition">
            <div class="flex items-center justify-between mb-2">
              <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
                <i class="fas fa-check-circle text-green-600"></i>
              </div>
            </div>
            <p class="text-xs lg:text-sm text-gray-600">Active</p>
            <p id="activeProducts" class="text-xl lg:text-2xl font-bold text-gray-900 mt-1">0</p>
          </div>

          <div class="bg-white rounded-xl shadow-sm p-4 lg:p-6 border border-gray-100 hover:shadow-md transition">
            <div class="flex items-center justify-between mb-2">
              <div class="w-10 h-10 bg-yellow-100 rounded-lg flex items-center justify-center">
                <i class="fas fa-exclamation-triangle text-yellow-600"></i>
              </div>
            </div>
            <p class="text-xs lg:text-sm text-gray-600">Low Stock</p>
            <p id="lowStock" class="text-xl lg:text-2xl font-bold text-gray-900 mt-1">0</p>
          </div>

          <div class="bg-white rounded-xl shadow-sm p-4 lg:p-6 border border-gray-100 hover:shadow-md transition">
            <div class="flex items-center justify-between mb-2">
              <div class="w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center">
                <i class="fas fa-ban text-red-600"></i>
              </div>
            </div>
            <p class="text-xs lg:text-sm text-gray-600">Inactive</p>
            <p id="inactiveProducts" class="text-xl lg:text-2xl font-bold text-gray-900 mt-1">0</p>
          </div>
        </div>

        <!-- Product Grid -->
        <div id="myProducts" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 lg:gap-6"></div>
      </div>
    </div>
  </main>
</div>

<!-- Add Product Modal -->
<div id="addProductModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
  <div class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col">
    <div class="p-4 lg:p-6 border-b border-gray-200 bg-gradient-to-r from-green-50 to-green-100">
      <div class="flex justify-between items-center">
        <div>
          <h1 class="text-xl lg:text-2xl font-bold text-gray-900">Add New Product</h1>
          <p class="text-gray-600 mt-1 text-xs lg:text-sm">Fill in the details to add a product to your inventory</p>
        </div>
        <button onclick="closeAddProductModal()" class="text-gray-500 hover:text-gray-700 hover:bg-gray-200 w-8 h-8 rounded-lg transition flex items-center justify-center">
          <i class="fas fa-times text-lg"></i>
        </button>
      </div>
    </div>

    <form id="productForm" class="p-4 lg:p-8 overflow-y-auto flex-1">
  
      <!-- BASIC INFO -->
      <div class="mb-6">
        <h2 class="text-lg lg:text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
          <i class="fas fa-info-circle text-green-600"></i>
          Product Information
        </h2>

        <div class="grid md:grid-cols-2 gap-4 lg:gap-5">
          <div>
            <label class="block text-xs lg:text-sm font-semibold mb-2 text-gray-700">Product Name *</label>
            <input id="name" required placeholder="Enter product name"
              class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-sm lg:text-base transition">
          </div>

          <div>
            <label class="block text-xs lg:text-sm font-semibold mb-2 text-gray-700">Category</label>
            <input id="category" placeholder="e.g., Electronics, Clothing"
              class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-sm lg:text-base transition">
          </div>
        </div>

        <div class="mt-4">
          <label class="block text-xs lg:text-sm font-semibold mb-2 text-gray-700">Description</label>
          <textarea id="description" rows="3" placeholder="Describe your product..."
            class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-sm lg:text-base transition"></textarea>
        </div>
      </div>

      <!-- PRICING -->
      <div class="mb-6">
        <h2 class="text-lg lg:text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
          <i class="fas fa-dollar-sign text-green-600"></i>
          Pricing & Inventory
        </h2>

        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 lg:gap-5">
          <div>
            <label class="block text-xs lg:text-sm font-semibold mb-2 text-gray-700">Price *</label>
            <div class="relative">
              <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500">$</span>
              <input id="price" type="number" step="0.01" required placeholder="0.00"
                class="w-full p-3 pl-8 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-sm lg:text-base transition">
            </div>
          </div>

          <div>
            <label class="block text-xs lg:text-sm font-semibold mb-2 text-gray-700">Discount Price</label>
            <div class="relative">
              <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500">$</span>
              <input id="discount_price" type="number" step="0.01" placeholder="0.00"
                class="w-full p-3 pl-8 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-sm lg:text-base transition">
            </div>
          </div>

          <div>
            <label class="block text-xs lg:text-sm font-semibold mb-2 text-gray-700">Stock Quantity</label>
            <input id="stock" type="number" placeholder="0"
              class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-sm lg:text-base transition">
          </div>
        </div>
      </div>

      <!-- EXTRA -->
      <div class="mb-6">
        <h2 class="text-lg lg:text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
          <i class="fas fa-cog text-green-600"></i>
          Additional Details
        </h2>

        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 lg:gap-5">
          <div>
            <label class="block text-xs lg:text-sm font-semibold mb-2 text-gray-700">SKU</label>
            <input id="sku" placeholder="Product SKU"
              class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-sm lg:text-base transition">
          </div>

          <div>
            <label class="block text-xs lg:text-sm font-semibold mb-2 text-gray-700">Brand</label>
            <input id="brand" placeholder="Brand name"
              class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-sm lg:text-base transition">
          </div>

          <div>
            <label class="block text-xs lg:text-sm font-semibold mb-2 text-gray-700">Status</label>
            <select id="status"
              class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-sm lg:text-base transition">
              <option value="active">Active</option>
              <option value="inactive">Inactive</option>
            </select>
          </div>
        </div>
      </div>

      <!-- IMAGES -->
      <div class="mb-6">
        <h2 class="text-lg lg:text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
          <i class="fas fa-image text-green-600"></i>
          Product Images
        </h2>

        <div class="space-y-4">
          <div>
            <label class="block text-xs lg:text-sm font-semibold mb-2 text-gray-700">Main Image *</label>
            <input id="main_image" type="file" accept="image/*" required
              class="w-full p-2 border border-gray-300 rounded-lg text-sm lg:text-base file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:bg-green-50 file:text-green-700 hover:file:bg-green-100 transition">
          </div>

          <div>
            <label class="block text-xs lg:text-sm font-semibold mb-2 text-gray-700">Gallery Images</label>
            <input id="gallery" type="file" accept="image/*" multiple
              class="w-full p-2 border border-gray-300 rounded-lg text-sm lg:text-base file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:bg-green-50 file:text-green-700 hover:file:bg-green-100 transition">
            <p class="text-xs text-gray-500 mt-2">Upload multiple images for product gallery</p>
          </div>
        </div>
      </div>

      <!-- ACTIONS -->
      <div class="flex flex-col sm:flex-row gap-3 pt-6 border-t">
        <button type="submit"
          class="w-full sm:w-auto bg-gradient-to-r from-green-600 to-green-700 text-white px-8 py-3 rounded-lg font-semibold hover:from-green-700 hover:to-green-800 transition shadow-lg flex items-center justify-center gap-2">
          <i class="fas fa-plus"></i>
          Add Product
        </button>

        <button type="button" onclick="closeAddProductModal()"
          class="w-full sm:w-auto bg-gray-100 text-gray-700 px-8 py-3 rounded-lg font-semibold hover:bg-gray-200 transition">
          Cancel
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Edit Product Modal -->
<div id="editModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
  <div class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col">
    <div class="p-4 lg:p-6 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-blue-100">
      <div class="flex justify-between items-center">
        <h3 class="text-lg lg:text-xl font-bold text-gray-900">Edit Product</h3>
        <button onclick="closeEditModal()" class="text-gray-500 hover:text-gray-700 hover:bg-gray-200 w-8 h-8 rounded-lg transition flex items-center justify-center">
          <i class="fas fa-times text-lg"></i>
        </button>
      </div>
    </div>
    <form id="editProductForm" class="p-4 lg:p-6 overflow-y-auto flex-1">
      <input type="hidden" id="editProductId" />
      
      <!-- Basic Information -->
      <div class="mb-4">
        <label class="block text-xs lg:text-sm font-semibold text-gray-700 mb-2">Product Name *</label>
        <input id="editName" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm lg:text-base transition" required />
      </div>
      
      <div class="mb-4">
        <label class="block text-xs lg:text-sm font-semibold text-gray-700 mb-2">Category</label>
        <input id="editCategory" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm lg:text-base transition" />
      </div>
      
      <div class="mb-4">
        <label class="block text-xs lg:text-sm font-semibold text-gray-700 mb-2">Description</label>
        <textarea id="editDescription" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm lg:text-base transition"></textarea>
      </div>
      
      <!-- Pricing -->
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-4">
        <div>
          <label class="block text-xs lg:text-sm font-semibold text-gray-700 mb-2">Price ($) *</label>
          <input id="editPrice" type="number" step="0.01" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm lg:text-base transition" required />
        </div>
        
        <div>
          <label class="block text-xs lg:text-sm font-semibold text-gray-700 mb-2">Discount Price</label>
          <input id="editDiscountPrice" type="number" step="0.01" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm lg:text-base transition" />
        </div>
        
        <div>
          <label class="block text-xs lg:text-sm font-semibold text-gray-700 mb-2">Stock</label>
          <input id="editStock" type="number" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm lg:text-base transition" />
        </div>
      </div>
      
      <!-- Additional Fields -->
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-4">
        <div>
          <label class="block text-xs lg:text-sm font-semibold text-gray-700 mb-2">SKU</label>
          <input id="editSKU" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm lg:text-base transition" />
        </div>
        
        <div>
          <label class="block text-xs lg:text-sm font-semibold text-gray-700 mb-2">Brand</label>
          <input id="editBrand" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm lg:text-base transition" />
        </div>
        
        <div>
          <label class="block text-xs lg:text-sm font-semibold text-gray-700 mb-2">Status</label>
          <select id="editStatus" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm lg:text-base transition">
            <option value="active">Active</option>
            <option value="inactive">Inactive</option>
          </select>
        </div>
      </div>
      
      <!-- Images -->
      <div class="mb-4">
        <label class="block text-xs lg:text-sm font-semibold text-gray-700 mb-2">Main Image</label>
        <input type="file" id="editMainImage" accept="image/*" class="w-full p-2 border border-gray-300 rounded-lg text-sm lg:text-base file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 transition" />
        <p class="text-xs text-gray-500 mt-2">Leave empty to keep current image</p>
      </div>
      
      <div class="mb-6">
        <label class="block text-xs lg:text-sm font-semibold text-gray-700 mb-2">Gallery Images</label>
        <input type="file" id="editGallery" accept="image/*" multiple class="w-full p-2 border border-gray-300 rounded-lg text-sm lg:text-base file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 transition" />
        <p class="text-xs text-gray-500 mt-2">Leave empty to keep current images</p>
      </div>
      
      <div class="flex flex-col sm:flex-row justify-end gap-3 pt-4 border-t">
        <button type="button" onclick="closeEditModal()" class="w-full sm:w-auto px-6 py-3 text-sm lg:text-base text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg font-semibold transition">
          Cancel
        </button>
        <button type="submit" class="w-full sm:w-auto px-6 py-3 text-sm lg:text-base text-white bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 rounded-lg font-semibold transition shadow-lg flex items-center justify-center gap-2">
          <i class="fas fa-save"></i>
          Save Changes
        </button>
      </div>
    </form>
  </div>
</div>

<!-- PRODUCT VIEW MODAL -->
<div id="productModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden z-50">
  <div class="flex items-center justify-center min-h-screen px-4 py-8">
    <div class="bg-white rounded-2xl max-w-5xl w-full shadow-2xl relative max-h-[90vh] overflow-y-auto">

      <!-- Close Button -->
      <button onclick="closeProductModal()"
        class="absolute top-4 right-4 text-gray-500 hover:text-gray-700 hover:bg-gray-200 w-10 h-10 rounded-lg transition z-10 flex items-center justify-center">
        <i class="fas fa-times text-lg"></i>
      </button>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 p-4 lg:p-8">

        <!-- Images -->
        <div>
          <img id="modalMainImage"
               class="w-full h-64 lg:h-80 object-cover rounded-xl mb-4 shadow-md">

          <div id="modalGallery" class="flex gap-2 overflow-x-auto pb-2"></div>
        </div>

        <!-- Details -->
        <div>
          <h2 id="modalName" class="text-2xl lg:text-3xl font-bold text-gray-900 mb-3"></h2>
          <p id="modalPrice" class="text-2xl lg:text-3xl text-green-600 font-bold mb-4"></p>

          <div class="space-y-3 mb-6">
            <div class="flex items-center gap-2">
              <i class="fas fa-tag text-gray-500"></i>
              <p class="text-sm text-gray-600">
                Category: <span id="modalCategory" class="font-semibold text-gray-900"></span>
              </p>
            </div>

            <div class="flex items-center gap-2">
              <i class="fas fa-boxes text-gray-500"></i>
              <p class="text-sm text-gray-600">
                Stock: <span id="modalStock" class="font-semibold text-gray-900"></span>
              </p>
            </div>

            <div class="flex items-center gap-2">
              <i class="fas fa-circle text-gray-500"></i>
              <p class="text-sm text-gray-600">
                Status: <span id="modalStatus" class="font-semibold text-gray-900"></span>
              </p>
            </div>
          </div>

          <div class="border-t pt-4">
            <h3 class="text-lg font-bold text-gray-900 mb-2">Description</h3>
            <p id="modalDescription" class="text-gray-600 leading-relaxed text-sm lg:text-base"></p>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>

<!-- Modal Component -->
<div id="modal" class="modal-overlay fixed inset-0 bg-black/30 backdrop-blur-lg z-50 hidden flex items-center justify-center p-4">
  <div class="modal-content bg-white rounded-xl shadow-2xl max-w-md w-full mx-4">
    <div id="modalHeader" class="p-4 lg:p-6 border-b border-gray-200">
      <div class="flex items-center gap-3">
        <div id="modalIcon" class="w-10 h-10 lg:w-12 lg:h-12 rounded-full flex items-center justify-center"></div>
        <h3 id="modalTitle" class="text-lg lg:text-xl font-bold text-gray-800"></h3>
      </div>
    </div>
    <div class="p-4 lg:p-6">
      <p id="modalMessage" class="text-sm lg:text-base text-gray-600"></p>
    </div>
    <div id="modalFooter" class="p-4 lg:p-6 border-t border-gray-200 flex justify-end gap-3">
      <button id="modalCancel" class="px-4 py-2 text-sm lg:text-base text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg font-semibold transition hidden">
        Cancel
      </button>
      <button id="modalConfirm" class="px-4 py-2 text-sm lg:text-base text-white rounded-lg font-semibold transition">
        OK
      </button>
    </div>
  </div>
</div>

<script src="js/shop/edit-product.js"></script>
<script src="js/shop/view-product.js"></script>

<script>
const token = localStorage.getItem("staffToken");

// Sidebar toggle for mobile
function toggleSidebar() {
  const sidebar = document.getElementById('sidebar');
  const overlay = document.getElementById('sidebarOverlay');
  const hamburgerIcon = document.getElementById('hamburgerIcon');
  const closeIcon = document.getElementById('closeIcon');
  
  sidebar.classList.toggle('-translate-x-full');
  overlay.classList.toggle('hidden');
  hamburgerIcon.classList.toggle('hidden');
  closeIcon.classList.toggle('hidden');
}

function closeSidebarMobile() {
  if (window.innerWidth < 1024) {
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('sidebarOverlay');
    const hamburgerIcon = document.getElementById('hamburgerIcon');
    const closeIcon = document.getElementById('closeIcon');
    
    sidebar.classList.add('-translate-x-full');
    overlay.classList.add('hidden');
    hamburgerIcon.classList.remove('hidden');
    closeIcon.classList.add('hidden');
  }
}

// Section switching
function showSection(sectionId) {
  document.getElementById('products').classList.remove('hidden');
}

// Modal functions
function openAddProductModal() {
  document.getElementById('addProductModal').classList.remove('hidden');
  document.body.style.overflow = 'hidden';
}

function closeAddProductModal() {
  document.getElementById('addProductModal').classList.add('hidden');
  document.getElementById('productForm').reset();
  document.body.style.overflow = 'auto';
}

// Logout
function logout() {
  localStorage.removeItem("staffToken");
  localStorage.removeItem("staffRole");
  window.location.href = "/login/login-staff.html";
}

// Update stats
function updateStats(products) {
  const total = products.length;
  const active = products.filter(p => p.status === 'active').length;
  const inactive = products.filter(p => p.status === 'inactive').length;
  const lowStock = products.filter(p => (p.stock || 0) < 10).length;
  
  document.getElementById('totalProducts').textContent = total;
  document.getElementById('activeProducts').textContent = active;
  document.getElementById('inactiveProducts').textContent = inactive;
  document.getElementById('lowStock').textContent = lowStock;
}

/* ---------- PRODUCTS ---------- */
async function loadMyProducts() {
  const container = document.getElementById("myProducts");
  container.innerHTML = '<div class="col-span-full flex items-center justify-center py-12"><div class="animate-pulse flex items-center gap-3"><div class="w-2 h-2 bg-green-600 rounded-full animate-bounce"></div><div class="w-2 h-2 bg-green-600 rounded-full animate-bounce" style="animation-delay: 0.1s"></div><div class="w-2 h-2 bg-green-600 rounded-full animate-bounce" style="animation-delay: 0.2s"></div></div></div>';

  try {
    const res = await fetch("/api/products/my", {
      headers: { Authorization: "Bearer " + token }
    });
    const products = await res.json();
    container.innerHTML = "";

    updateStats(products);

    if (!products.length) {
      container.innerHTML = `
        <div class="col-span-full bg-white rounded-xl shadow-sm p-12 text-center border border-gray-100">
          <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <i class="fas fa-box-open text-gray-400 text-2xl"></i>
          </div>
          <h3 class="text-lg font-bold text-gray-900 mb-2">No products yet</h3>
          <p class="text-gray-600 mb-6">Start by adding your first product to the inventory</p>
          <button onclick="openAddProductModal()" class="bg-gradient-to-r from-green-600 to-green-700 text-white px-6 py-3 rounded-lg font-semibold hover:from-green-700 hover:to-green-800 transition">
            <i class="fas fa-plus mr-2"></i>Add Your First Product
          </button>
        </div>
      `;
      return;
    }

    products.forEach(p => {
      const imageUrl = p.main_image
          ? `http://localhost:5000/uploads/products/${p.main_image}`
          : "https://via.placeholder.com/300x200?text=No+Image";

      const discountBadge = p.discount_price && p.discount_price < p.price
        ? `<span class="absolute top-2 right-2 bg-red-500 text-white text-xs px-2 py-1 rounded-full font-bold">SALE</span>`
        : '';

      const stockBadge = (p.stock || 0) < 10
        ? `<span class="absolute top-2 left-2 bg-yellow-500 text-white text-xs px-2 py-1 rounded-full font-bold">Low Stock</span>`
        : '';

        container.innerHTML += `
          <div class="bg-white rounded-xl shadow-sm hover:shadow-xl transition-all duration-300 overflow-hidden border border-gray-100 group">
            <!-- Product Image -->
            <div class="relative overflow-hidden">
              ${discountBadge}
              ${stockBadge}
              <img src="${imageUrl}" 
                  alt="${p.name}"
                  class="w-full h-48 object-cover group-hover:scale-110 transition-transform duration-300">
            </div>

            <div class="p-4 lg:p-5">
              <!-- Name & Status -->
              <div class="flex justify-between items-start mb-3">
                <h3 class="font-bold text-base lg:text-lg text-gray-900 line-clamp-1 flex-1">
                  ${p.name}
                </h3>
                <span class="text-xs px-2.5 py-1 rounded-full ml-2 flex-shrink-0
                  ${p.status === "active" ? "bg-green-100 text-green-700 border border-green-200" : "bg-gray-100 text-gray-700 border border-gray-200"}">
                  ${p.status || "active"}
                </span>
              </div>

              <!-- Category -->
              <div class="flex items-center gap-2 mb-2">
                <i class="fas fa-tag text-gray-400 text-xs"></i>
                <p class="text-xs text-gray-500">
                  ${p.category || "Uncategorized"}
                </p>
              </div>

              <!-- Description -->
              <p class="text-xs lg:text-sm text-gray-600 mb-4 line-clamp-2 min-h-[2.5rem]">
                ${p.description || "No description available"}
              </p>

              <!-- Price & Stock -->
              <div class="flex justify-between items-center mb-4 pb-4 border-b">
                <div>
                  <p class="text-xl lg:text-2xl font-bold text-green-600">
                    ${Number(p.price).toFixed(2)}
                  </p>
                  ${p.discount_price && p.discount_price < p.price ? `<p class="text-xs text-gray-400 line-through">${Number(p.discount_price).toFixed(2)}</p>` : ''}
                </div>
                <div class="text-right">
                  <p class="text-sm font-semibold ${(p.stock || 0) < 10 ? 'text-red-600' : 'text-gray-900'}">
                    ${p.stock ?? 0}
                  </p>
                  <p class="text-xs text-gray-500">in stock</p>
                </div>
              </div>

              <!-- Actions -->
              <div class="grid grid-cols-2 gap-2">
                <button onclick="viewProductDetails(${p.id})"
                  class="bg-gray-50 text-gray-700 py-2.5 rounded-lg hover:bg-gray-100 transition text-sm font-semibold border border-gray-200 flex items-center justify-center gap-2">
                  <i class="fas fa-eye text-xs"></i>
                  <span>View</span>
                </button>

                <button onclick='openEditModal(${JSON.stringify(p).replace(/'/g, "&#39;")})'
                  class="bg-blue-50 text-blue-600 py-2.5 rounded-lg hover:bg-blue-100 transition text-sm font-semibold border border-blue-200 flex items-center justify-center gap-2">
                  <i class="fas fa-edit text-xs"></i>
                  <span>Edit</span>
                </button>
              </div>
            </div>
          </div>
        `;
    });
  } catch (error) {
    container.innerHTML = `
      <div class="col-span-full bg-red-50 border border-red-200 rounded-xl p-8 text-center">
        <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
          <i class="fas fa-exclamation-triangle text-red-600 text-2xl"></i>
        </div>
        <h3 class="text-lg font-bold text-red-900 mb-2">Failed to load products</h3>
        <p class="text-red-700 mb-4">${error.message}</p>
        <button onclick="loadMyProducts()" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700 transition">
          <i class="fas fa-sync mr-2"></i>Try Again
        </button>
      </div>
    `;
  }
}

// Create Product

document.getElementById("productForm").addEventListener("submit", async e => {
  e.preventDefault();

  const fd = new FormData();

  fd.append("name", document.getElementById("name").value.trim());
  fd.append("description", document.getElementById("description").value.trim());
  fd.append("price", document.getElementById("price").value);
  fd.append("discount_price", document.getElementById("discount_price").value);
  fd.append("category", document.getElementById("category").value);
  fd.append("stock", document.getElementById("stock").value);
  fd.append("sku", document.getElementById("sku").value);
  fd.append("brand", document.getElementById("brand").value);
  fd.append("status", document.getElementById("status").value);

  // Images
  fd.append("main_image", document.getElementById("main_image").files[0]);

  const galleryFiles = document.getElementById("gallery").files;
  for (let i = 0; i < galleryFiles.length; i++) {
    fd.append("gallery", galleryFiles[i]);
  }

  const res = await fetch("/api/products", {
    method: "POST",
    headers: {
      Authorization: "Bearer " + token
      // âŒ DO NOT set Content-Type manually
    },
    body: fd
  });

  const data = await res.json();

  if (res.ok) {
    alert("Product added successfully!");
    e.target.reset();
    showSection("products");
  } else {
    alert(data.message || data.error || "Failed to add product");
  }
});

/* ---------- MODAL FUNCTIONS ---------- */
function showModal(title, message, type = 'info', confirmCallback = null) {
  const modal = document.getElementById('modal');
  const modalIcon = document.getElementById('modalIcon');
  const modalTitle = document.getElementById('modalTitle');
  const modalMessage = document.getElementById('modalMessage');
  const modalConfirm = document.getElementById('modalConfirm');
  const modalCancel = document.getElementById('modalCancel');

  modalTitle.textContent = title;
  modalMessage.textContent = message;

  // Set icon and colors based on type
  const types = {
    success: { icon: 'fa-check-circle', bg: 'bg-green-100', text: 'text-green-600', btn: 'bg-green-600 hover:bg-green-700' },
    error: { icon: 'fa-exclamation-circle', bg: 'bg-red-100', text: 'text-red-600', btn: 'bg-red-600 hover:bg-red-700' },
    warning: { icon: 'fa-exclamation-triangle', bg: 'bg-amber-100', text: 'text-amber-600', btn: 'bg-amber-600 hover:bg-amber-700' },
    info: { icon: 'fa-info-circle', bg: 'bg-blue-100', text: 'text-blue-600', btn: 'bg-blue-600 hover:bg-blue-700' },
    confirm: { icon: 'fa-question-circle', bg: 'bg-purple-100', text: 'text-purple-600', btn: 'bg-purple-600 hover:bg-purple-700' }
  };

  const config = types[type] || types.info;
  modalIcon.className = `w-10 h-10 lg:w-12 lg:h-12 rounded-full flex items-center justify-center ${config.bg}`;
  modalIcon.innerHTML = `<i class="fas ${config.icon} ${config.text} text-xl lg:text-2xl"></i>`;
  modalConfirm.className = `px-4 py-2 text-sm lg:text-base text-white rounded-lg font-semibold transition ${config.btn}`;

  if (confirmCallback) {
    modalCancel.classList.remove('hidden');
    modalConfirm.textContent = 'Confirm';
    modalConfirm.onclick = () => {
      modal.classList.add('hidden');
      confirmCallback();
    };
    modalCancel.onclick = () => modal.classList.add('hidden');
  } else {
    modalCancel.classList.add('hidden');
    modalConfirm.textContent = 'OK';
    modalConfirm.onclick = () => modal.classList.add('hidden');
  }

  modal.classList.remove('hidden');
}


// Initial load
loadMyProducts();
</script>

</body>
</html>