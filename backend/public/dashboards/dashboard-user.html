<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ShopZone</title>
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
 <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    * { font-family: 'Inter', sans-serif; }

    /* ---------------- HERO SLIDER ---------------- */
    .hero-slider {
      position: relative;
      overflow: hidden;
      height: 420px;
      border-radius: 24px;
    }

    .slider-track {
      display: flex;
      transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
      height: 100%;
    }

    .slide {
      min-width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
    }

    .slide-content {
      display: flex;
      align-items: center;
      justify-content: space-between;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 50px;
      gap: 50px;
    }

    .slide-info {
      flex: 1;
      color: white;
    }

    .slide-info h2 {
      font-size: 1.6rem;
      font-weight: 700;
      margin-bottom: 12px;
      line-height: 1.3;
    }

    .slide-info p {
      font-size: 0.9rem;
    }

    .slide-info .price {
      font-size: 1.2rem;
      font-weight: 700;
    }

    .slide-info .old-price {
      font-size: 0.9rem;
      opacity: 0.6;
    }

    .slide-info .badge {
      font-size: 0.7rem;
      padding: 4px 10px;
      border-radius: 9999px;
    }

    .slide-info button {
      font-size: 0.85rem;
      padding: 10px 18px;
      border-radius: 12px;
    }

    .slide-image img {
      max-width: 320px;
      max-height: 320px;
      object-fit: contain;
      filter: drop-shadow(0 20px 40px rgba(0,0,0,0.3));
      animation: float 3s ease-in-out infinite;
    }

    @keyframes float {
      0%,100% { transform: translateY(0); }
      50% { transform: translateY(-15px); }
    }

    .slider-dots {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 10px;
    }

    .dot {
      width: 10px;
      height: 10px;
      border-radius: 9999px;
      background: rgba(255,255,255,0.4);
    }

    .dot.active {
      width: 26px;
      background: white;
      border-radius: 6px;
    }

    .slider-nav {
      width: 44px;
      height: 44px;
      border-radius: 9999px;
    }

    /* ---------------- CART PANEL ---------------- */
    #cartPanel {
      transition: transform 0.3s ease;
      transform: translateX(100%);
    }
    #cartPanel.open {
      transform: translateX(0);
    }
  </style>
</head>

<body class="bg-gray-100">

<script>
if (!localStorage.getItem("token")) {
  window.location.href = "login.html";
}
</script>

<!-- NAVBAR -->
<nav class="bg-white shadow sticky top-0 z-50">
  <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
    <h1 class="text-2xl font-bold text-blue-600">ShopZone</h1>

    <div class="flex gap-2">
      <button onclick="showTab('home')" class="tab-btn font-semibold active" data-tab="home">Home</button>
      <button onclick="showTab('shops')" class="tab-btn" data-tab="shops">Shops</button>
      <button onclick="showTab('products')" class="tab-btn" data-tab="products">Products</button>
      <button onclick="goToProfile()" class="tab-btn">My Profile</button>
    </div>

    <button onclick="logout()" class="bg-red-500 text-white px-4 py-2 rounded-lg font-semibold">Logout</button>
  </div>
</nav>

<!-- MAIN -->
<main class="max-w-7xl mx-auto px-6 py-8 space-y-10">

  <!-- HOME TAB -->
  <section id="home" class="tab-section">
    <!-- HERO SLIDER -->
    <div class="hero-slider mb-12">
      <div class="slider-track" id="sliderTrack"></div>
      
      <div class="slider-nav prev" onclick="prevSlide()">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M15 19l-7-7 7-7"></path>
        </svg>
      </div>
      
      <div class="slider-nav next" onclick="nextSlide()">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M9 5l7 7-7 7"></path>
        </svg>
      </div>
      
      <div class="slider-dots" id="sliderDots"></div>
    </div>

    <div class="mb-6">
      <input id="homeSearchInput" type="text" placeholder="Search products in Home..." class="border p-3 rounded w-full md:w-1/2">
    </div>

    <h2 class="text-xl font-bold mb-4">Popular Shops</h2>
    <div id="popularShops" class="space-y-2 mb-10"></div>

    <h2 class="text-xl font-bold mb-4">Recently Added</h2>
    <div id="recentProducts" class="space-y-2"></div>
  </section>

  <!-- SHOPS TAB -->
  <section id="shops" class="tab-section hidden">
    <div class="mb-6">
      <input id="shopsSearchInput" type="text" placeholder="Search shops..." class="border p-3 rounded w-full md:w-1/2">
    </div>

    <h2 class="text-xl font-bold mb-6">Browse Shops</h2>
    <div id="shopsList" class="space-y-2"></div>
  </section>

  <!-- PRODUCTS TAB -->
  <section id="products" class="tab-section hidden">
    <div class="mb-6">
      <input id="productsSearchInput" type="text" placeholder="Search products..." class="border p-3 rounded w-full md:w-1/2">
    </div>

    <div class="filter-container bg-white p-4 rounded-lg shadow mb-6 flex gap-4 flex-wrap">
      <select id="filterCategory" class="border p-2 rounded"><option value="">All Categories</option></select>
      <select id="filterShop" class="border p-2 rounded"><option value="">All Shops</option></select>
      <select id="filterPrice" class="border p-2 rounded">
        <option value="">Price</option>
        <option value="low">Low to High</option>
        <option value="high">High to Low</option>
      </select>
    </div>

    <div id="productsList" class="space-y-2"></div>
  </section>

</main>

<!-- CART PANEL -->
<div id="cartPanel" class="fixed top-0 right-0 h-full w-80 bg-white shadow-lg flex flex-col z-50">
  <div class="flex justify-between items-center p-4 border-b">
    <h2 class="text-lg font-bold">Your Cart</h2>
    <button onclick="closeCart()" class="text-red-500 font-bold">&times;</button>
  </div>
  <div id="cartItems" class="flex-1 overflow-y-auto p-4 space-y-4"></div>
  <div class="p-4 border-t">
    <p class="font-semibold mb-2">Total: $<span id="cartTotal">0</span></p>
    <button class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700 transition">Checkout</button>
  </div>
</div>

<!-- FLOATING CART BUTTON -->
<div id="cartButton" onclick="openCart()">üõí</div>

<!-- WHY SHOP WITH US -->
<section class="bg-white rounded-2xl shadow p-8 mt-12 max-w-6xl mx-auto">
  <h2 class="text-xl font-bold text-center mb-8">Why Shop With ShopZone?</h2>

  <div class="grid grid-cols-1 md:grid-cols-4 gap-6 text-center">
    
    <div class="p-4">
      <div class="text-blue-600 text-3xl mb-3">üîí</div>
      <h3 class="font-semibold mb-1">Secure Payments</h3>
      <p class="text-sm text-gray-500">
        Your payments are protected and processed securely.
      </p>
    </div>

    <div class="p-4">
      <div class="text-blue-600 text-3xl mb-3">üè™</div>
      <h3 class="font-semibold mb-1">Verified Shops</h3>
      <p class="text-sm text-gray-500">
        All sellers are verified for quality and trust.
      </p>
    </div>

    <div class="p-4">
      <div class="text-blue-600 text-3xl mb-3">üöö</div>
      <h3 class="font-semibold mb-1">Fast Delivery</h3>
      <p class="text-sm text-gray-500">
        Quick and reliable delivery across the country.
      </p>
    </div>

    <div class="p-4">
      <div class="text-blue-600 text-3xl mb-3">‚Ü©Ô∏è</div>
      <h3 class="font-semibold mb-1">Easy Returns</h3>
      <p class="text-sm text-gray-500">
        Simple return process if you‚Äôre not satisfied.
      </p>
    </div>

  </div>
</section>


<!-- SELL ON SHOPZONE CTA -->
<section class="bg-gradient-to-r from-blue-600 to-blue-800 text-white rounded-2xl p-10 mt-12 flex flex-col md:flex-row items-center justify-between gap-6 max-w-6xl mx-auto">
  
  <div>
    <h2 class="text-2xl font-bold mb-2">Want to sell on ShopZone?</h2>
    <p class="text-blue-100 text-sm">
      Open your shop today and reach thousands of customers.
    </p>
  </div>

  <button
    onclick="window.location.href='create-shop.html'"
    class="bg-white text-blue-700 font-semibold px-8 py-3 rounded-xl hover:bg-blue-50 transition shadow">
    Open a Shop
  </button>

</section>


<!-- FOOTER -->
<footer class="bg-white py-6 text-center text-gray-500 text-sm mt-10">¬© 2026 ShopZone</footer>


<script>
/* ------------------------- AUTH & NAV ------------------------- */
function logout(){
  localStorage.removeItem("token");
  window.location.href = "/login/login.html";
}
function showTab(tab){
  document.querySelectorAll('.tab-section').forEach(s => s.classList.add('hidden'));
  document.getElementById(tab).classList.remove('hidden');
  
  document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.classList.remove('active');
    if(btn.getAttribute('data-tab') === tab) {
      btn.classList.add('active');
    }
  });
}
function goToProfile(){
  window.location.href = "user-profile.html";
}

/* ------------------------- GLOBAL ------------------------- */
let allProducts = [];
let allShops = [];
let cart = JSON.parse(localStorage.getItem('shopzone_cart') || '[]');
const cartPanel = document.getElementById("cartPanel");

/* ------------------------- HERO SLIDER ------------------------- */
let currentSlideIndex = 0;
let sliderInterval;
let featuredProducts = [];

function createSlide(product) {
  const price = product.discount && product.discount > 0 
    ? product.price - (product.price * product.discount / 100)
    : product.price;
  
  const hasDiscount = product.discount && product.discount > 0;
  const savings = hasDiscount ? product.discount : 0;
  
  const stockStatus = product.stock > 0
    ? `<span class="inline-block bg-green-500 text-white px-4 py-2 rounded-full text-sm font-bold">‚úì In Stock (${product.stock})</span>`
    : `<span class="inline-block bg-red-500 text-white px-4 py-2 rounded-full text-sm font-bold">‚úó Out of Stock</span>`;
  
  return `
    <div class="slide">
      <div class="slide-content">
        <div class="slide-info">
          <div class="mb-3 inline-block text-blue-500 bg-white bg-opacity-20 px-4 py-2 rounded-full text-sm font-semibold backdrop-blur-sm">
            ${product.category || 'Featured Product'}
          </div>
          <h2 class="text-5xl font-bold mb-6 leading-tight">${product.name}</h2>
          
          <div class="mb-6">
            ${stockStatus}
          </div>
          
          <div class="flex items-center gap-4 mb-8">
            ${hasDiscount ? `
              <span class="text-3xl line-through text-blue-200">${product.price}</span>
              <span class="text-5xl font-bold">${price.toFixed(2)}</span>
              <span class="bg-red-500 px-4 py-2 rounded-full text-lg font-bold">-${savings}%</span>
            ` : `
              <span class="text-5xl font-bold">${price.toFixed(2)}</span>
            `}
          </div>
          
          <div class="mb-6">
            <p class="text-blue-100 text-lg">From <span class="font-bold text-white">${product.shop_name || 'Our Store'}</span></p>
          </div>
          
          <div class="flex gap-4">
            <button onclick="viewProduct(${product.id})" class="bg-white text-blue-600 px-8 py-4 rounded-xl font-bold text-lg hover:bg-blue-50 transition shadow-lg">
              View Details
            </button>
            <button onclick="addToCartFromSlider(${product.id})" class="bg-green-500 border-2 border-white text-white px-8 py-4 rounded-xl font-bold text-lg hover:bg-green-600 transition shadow-lg" ${product.stock <= 0 ? 'disabled style="opacity:0.5; cursor:not-allowed;"' : ''}>
              Add to Cart
            </button>
          </div>
        </div>
        
        <div class="slide-image">
          <img src="/uploads/products/${product.main_image || 'https://placehold.co/400x400?text=Product'}" alt="${product.name}">
        </div>
      </div>
    </div>
  `;
}

function initSlider() {
  featuredProducts = allProducts.slice(0, 6);
  
  const sliderTrack = document.getElementById('sliderTrack');
  const sliderDots = document.getElementById('sliderDots');
  
  sliderTrack.innerHTML = featuredProducts.map(createSlide).join('');
  sliderDots.innerHTML = featuredProducts.map((_, i) => 
    `<div class="dot ${i === 0 ? 'active' : ''}" onclick="goToSlide(${i})"></div>`
  ).join('');
  
  startAutoSlide();
}

function goToSlide(index) {
  currentSlideIndex = index;
  updateSlider();
  resetAutoSlide();
}

function nextSlide() {
  currentSlideIndex = (currentSlideIndex + 1) % featuredProducts.length;
  updateSlider();
  resetAutoSlide();
}

function prevSlide() {
  currentSlideIndex = (currentSlideIndex - 1 + featuredProducts.length) % featuredProducts.length;
  updateSlider();
  resetAutoSlide();
}

function updateSlider() {
  const sliderTrack = document.getElementById('sliderTrack');
  sliderTrack.style.transform = `translateX(-${currentSlideIndex * 100}%)`;
  
  document.querySelectorAll('.dot').forEach((dot, i) => {
    dot.classList.toggle('active', i === currentSlideIndex);
  });
}

function startAutoSlide() {
  sliderInterval = setInterval(nextSlide, 5000);
}

function resetAutoSlide() {
  clearInterval(sliderInterval);
  startAutoSlide();
}

function viewProduct(productId) {
  window.location.href = `product-details.html?id=${productId}`;
}

function addToCartFromSlider(productId) {
  const product = allProducts.find(p => p.id == productId);
  if (product) {
    if (product.stock <= 0) {
      alert("This product is out of stock");
      return;
    }
    addToCart(product);
  }
}

/* ------------------------- CART ------------------------- */
function openCart(){ cartPanel.classList.add("open"); }
function closeCart(){ cartPanel.classList.remove("open"); }

function updateCart(){
  const container = document.getElementById("cartItems");
  container.innerHTML = "";
  let total = 0;
  cart.forEach((item,index)=>{
    const price = item.discount && item.discount<item.price ? item.discount : item.price;
    const itemTotal = price*item.qty;
    total+=itemTotal;
    container.innerHTML += `
      <div class="cart-item flex gap-2 items-center p-2">
        <img src="/uploads/products/${item.main_image || 'https://placehold.co/50x50?text=Product'}" class="w-12 h-12 object-cover rounded">
        <div class="flex-1">
          <p class="text-sm font-semibold">${item.name}</p>
          <p class="text-xs text-gray-500">${price} x ${item.qty}</p>
        </div>
        <button onclick="removeFromCart(${index})" class="text-red-500 font-bold">&times;</button>
      </div>`;
  });
  document.getElementById("cartTotal").textContent = total;
  localStorage.setItem('shopzone_cart', JSON.stringify(cart));
}

function addToCart(product){
  const existing = cart.find(p=>p.id===product.id);
  if(existing){ 
    existing.qty++; 
  } else{ 
    cart.push({...product,qty:1}); 
  }
  updateCart();
  openCart();
}

function removeFromCart(index){ 
  cart.splice(index,1); 
  updateCart(); 
}

function formatMoney(amount, currency = "TZS", locale = "sw-TZ") {
  if (isNaN(amount)) return "0.00";
  return new Intl.NumberFormat(locale, {
    style: "currency",
    currency: currency,
    minimumFractionDigits: 2
  }).format(amount);
}

function attachCartButtons(){
  document.querySelectorAll(".add-to-cart-btn").forEach(btn => {
    btn.onclick = () => {
      const productId = btn.closest('[data-id]').dataset.id;
      const product = allProducts.find(p => p.id == productId);

      if (!product) return;

      if (product.stock <= 0) {
        alert("This product is out of stock");
        return;
      }

      addToCart(product);
      openCart();
    };
  });
}

/* ------------------------- PRODUCT CARD ------------------------- */
function productCard(p){
  let priceHtml = `$${p.price}`;

  if (p.discount && p.discount > 0) {
    const discountedPrice = p.price - (p.price * p.discount / 100);

    priceHtml = `
      <span class="line-through text-gray-400 mr-2">${formatMoney(p.price)}</span>
      <span class="text-blue-600 font-bold">${formatMoney(discountedPrice.toFixed(2))}</span>
      <span class="text-red-500 text-sm font-semibold ml-2">${p.discount}% OFF</span>
    `;
  }

  const stockStatus = p.stock > 0
    ? `<span class="text-green-600 font-semibold text-sm">In Stock (${p.stock})</span>`
    : `<span class="text-red-600 font-semibold text-sm">Out of Stock</span>`;

  return `
    <div data-id="${p.id}" 
         class="product-item flex gap-4 items-center"
         onclick="window.location.href='product-details.html?id=${p.id}'"
         style="cursor:pointer;">

      <img src="/uploads/products/${p.main_image || 'https://placehold.co/100x100?text=Product'}"
           class="w-24 h-24 object-cover rounded-lg">

      <div class="flex-1">
        <h3 class="font-semibold text-base">${p.name}</h3>
        <p class="text-sm text-gray-500">
          ${p.category || 'Uncategorized'} ‚Ä¢ ${p.shop_name}
        </p>

        <div class="mt-2 flex items-center gap-3">
          <span class="text-lg font-bold">${priceHtml}</span>
          ${stockStatus}
        </div>
      </div>

      <button
        onclick="event.stopPropagation()"
        class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition add-to-cart-btn"
        ${p.stock <= 0 ? 'disabled class="opacity-50 cursor-not-allowed"' : ''}>
        Add to Cart
      </button>
    </div>`;
}

/* ------------------------- LOAD DATA ------------------------- */
async function loadData(){
  const res = await fetch("/api/products");
  allProducts = await res.json();
  
  initSlider();
  
  recentProducts.innerHTML = allProducts.slice(-4).map(productCard).join("");
  productsList.innerHTML = allProducts.map(productCard).join("");
  attachCartButtons();

  const categories = [...new Set(allProducts.map(p=>p.category).filter(Boolean))];
  filterCategory.innerHTML = `<option value="">All Categories</option>`+categories.map(c=>`<option value="${c}">${c}</option>`).join("");
  const shops = [...new Set(allProducts.map(p=>p.shop_name))];
  filterShop.innerHTML = `<option value="">All Shops</option>`+shops.map(s=>`<option value="${s}">${s}</option>`).join("");
}

/* ------------------------- LOAD SHOPS ------------------------- */
async function loadShops(){
  const res = await fetch("/api/shops");
  allShops = await res.json();
  shopsList.innerHTML = allShops.map(s=>`
    <div class="shop-item flex gap-4 items-center">
      <img src="${s.logo || 'https://placehold.co/80x80?text=Shop'}" class="w-20 h-20 rounded-full object-cover">
      <div class="flex-1">
        <h3 class="font-bold text-base">${s.shop_name}</h3>
      </div>
      <button onclick="window.location.href='shop.html?id=${s.id}'" class="text-blue-600 font-semibold hover:underline">View Details ‚Üí</button>
    </div>`).join("");

  popularShops.innerHTML = allShops.slice(0,5).map(s=>`
    <div class="shop-item flex gap-4 items-center">
      <img src="${s.logo || 'https://placehold.co/60x60?text=Shop'}" class="w-16 h-16 rounded-full object-cover">
      <div class="flex-1">
        <p class="font-semibold">${s.shop_name}</p>
      </div>
    </div>`).join("");
}

/* ------------------------- SEARCH & FILTER ------------------------- */
productsSearchInput.addEventListener("input", applyProductFilters);
filterCategory.addEventListener("change", applyProductFilters);
filterShop.addEventListener("change", applyProductFilters);
filterPrice.addEventListener("change", applyProductFilters);

function applyProductFilters(){
  let filtered = [...allProducts];
  const search = productsSearchInput.value.toLowerCase();
  if(search) filtered = filtered.filter(p=>p.name.toLowerCase().includes(search));
  if(filterCategory.value) filtered = filtered.filter(p=>p.category===filterCategory.value);
  if(filterShop.value) filtered = filtered.filter(p=>p.shop_name===filterShop.value);
  if(filterPrice.value==='low') filtered.sort((a,b)=> (a.discount||a.price)-(b.discount||b.price));
  if(filterPrice.value==='high') filtered.sort((a,b)=> (b.discount||b.price)-(a.discount||a.price));
  productsList.innerHTML = filtered.map(productCard).join("");
  attachCartButtons();
}

/* ------------------------- HOME SEARCH ------------------------- */
homeSearchInput.addEventListener("input", ()=>{
  const search = homeSearchInput.value.toLowerCase();
  recentProducts.innerHTML = allProducts.filter(p=>p.name.toLowerCase().includes(search)).slice(-4).map(productCard).join("");
  attachCartButtons();
});

shopsSearchInput.addEventListener("input", ()=>{
  const search = shopsSearchInput.value.toLowerCase();
  const filtered = allShops.filter(s=>s.shop_name.toLowerCase().includes(search));
  shopsList.innerHTML = filtered.map(s=>`
    <div class="shop-item flex gap-4 items-center">
      <img src="${s.logo || 'https://placehold.co/80x80?text=Shop'}" class="w-20 h-20 rounded-full object-cover">
      <div class="flex-1">
        <h3 class="font-bold text-base">${s.shop_name}</h3>
      </div>
      <button onclick="window.location.href='shop.html?id=${s.id}'" class="text-blue-600 font-semibold hover:underline">View Details ‚Üí</button>
    </div>`).join("");
  popularShops.innerHTML = filtered.slice(0,5).map(s=>`
    <div class="shop-item flex gap-4 items-center">
      <img src="${s.logo || 'https://placehold.co/60x60?text=Shop'}" class="w-16 h-16 rounded-full object-cover">
      <div class="flex-1">
        <p class="font-semibold">${s.shop_name}</p>
      </div>
    </div>`).join("");
});

/* ------------------------- INIT ------------------------- */
loadData();
loadShops();
showTab('home');
updateCart();
</script>
</body>
</html>